create function dna.datestr(@time datetime,@format nvarchar(50))returns nvarchar(50)as begin  declare @year nvarchar(4),@month nvarchar(2),@day nvarchar(2),@dayinweek nvarchar(2),@dayinyear nvarchar(3),@hour nvarchar(2),@minius nvarchar(2),@seconds nvarchar(2),@quarter nvarchar(2),@wkofyear nvarchar(2),@wkofmonth nvarchar(2)  set @year=datepart(yy,@time)  set @month=datepart(mm,@time)  if(len(@month)=1)  begin  set @month='0'+@month  end  set @day=datepart(dd,@time)  if(len(@day)=1)  begin  set @day='0'+@day  end  set @hour=datepart(hh,@time)  if(len(@hour)=1)  begin  set @hour='0'+@hour  end  set @minius=datepart(mi,@time)  if(len(@minius)=1)  begin  set @minius='0'+@minius  end  set @seconds=datepart(s,@time)  if(len(@seconds)=1)  begin  set @seconds='0'+@seconds  end  set @dayinweek=datepart(w,@time)  set @dayinyear=datepart(dy,@time)  if(len(@dayinyear)=1)  begin  set @dayinyear='00'+@dayinyear  end  else if(len(@dayinyear)=2)  begin  set @dayinyear='0'+@dayinyear  end  set @quarter=datepart(q,@time)  set @wkofyear=datepart(wk,@time)  if(len(@wkofyear)=1)  begin  set @wkofyear='0'+@wkofyear  end  set @wkofmonth=(@day+datepart(w,dateadd(day,-cast(@day as int),@time))-1)/7+1    set @format=replace(@format,'yyyy',@year)  set @format=replace(@format,'yy',substring(@year,3,5))  set @format=replace(@format,'mm',@month)  set @format=replace(@format,'ddd',@dayinyear)  set @format=replace(@format,'dd',@day)  set @format=replace(@format,'d',@dayinweek)  set @format=replace(@format,'q',@quarter)  set @format=replace(@format,'ww',@wkofyear)  set @format=replace(@format,'w',@wkofmonth)  set @format=replace(@format,'hh24',@hour)    if(charindex('hh12',@format)=0 and charindex('hh',@format)!=0)  begin  set @format=replace(@format,'hh','hh12')  end  if(charindex('hh12',@format)!=0 and @hour>12)  begin  if(@hour<22)  begin  set @hour=cast(@hour-12 as nvarchar(2))  set @format=replace(@format,'hh12','0'+@hour)  end  else set @format=replace(@format,'hh12',@hour-12)  if(charindex('am',@format)!=0)  begin  set @format=replace(@format,'am','PM')  end  end  else if(charindex('hh12',@format)!=0 and @hour=12)  begin  set @format=replace(@format,'hh12',@hour)  if(charindex('am',@format)!=0)  begin  set @format=replace(@format,'am','PM')  end  end  else if(charindex('hh12',@format)!=0 and @hour<12 and @hour!=0)  begin  set @format=replace(@format,'hh12',@hour)  if(charindex('am',@format)!=0)  begin  set @format=replace(@format,'am','AM')  end  end  else if(charindex('hh12',@format)!=0 and @hour<12 and @hour=0)  begin  set @format=replace(@format,'hh12',12)  if(charindex('am',@format)!=0)  begin  set @format=replace(@format,'am','AM')  end  end    set @format=replace(@format,'mi',@minius)  set @format=replace(@format,'ss',@seconds)  return @formatend